// {{ ansible_managed }}

{% if icinga2_mode == 'satellite' %}
{% if icinga2_satellite_zone is defined %}
{% if icinga2_satellites is mapping -%}
{% if icinga2_satellites[icinga2_satellite_zone] is defined -%}
{%- set _keys = icinga2_satellites[icinga2_satellite_zone].keys() -%}
{%- for s in _keys -%}
object Endpoint "{{ s }}" {
{%- if icinga2_satellites[icinga2_satellite_zone][s]['ip'] is defined %} host = "{{ icinga2_satellites[icinga2_satellite_zone][s]['ip'] }}"; {% endif %}
  port = "5665" }
{% endfor %}
object Zone "{{ icinga2_satellite_zone }}" { endpoints = [ "{{ _keys | join( '", "') }}" ] ; parent = "master" }
{% else %}
// no zone config for '{{ icinga2_satellite_zone }}' found!
object Endpoint "{{ icinga2_satellite_zone }}" { host = "{{ ansible_fqdn }}"; port = "5665" }
object Zone "{{ icinga2_satellite_zone }}" { endpoints = [ "{{ ansible_fqdn }}" ] ; parent = "master" }
{% endif -%}
{% endif -%}
{% endif -%}
{% endif -%}
